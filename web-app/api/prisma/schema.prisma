generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model Tenant {
  id          String       @id @default(cuid())
  name        String
  slug        String       @unique
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  users       User[]
  facilities  Facility[]
  claims      Claim[]
  tenantRoles TenantRole[]

  @@schema("public")
}

model User {
  id          String       @id @default(cuid())
  email       String       @unique
  name        String
  role        UserRole
  tenantId    String
  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  appeals     Appeal[]
  tenantRoles TenantRole[]

  @@schema("public")
}

enum UserRole {
  BILLING_SPECIALIST
  MANAGER
  EXECUTIVE
  ADMIN

  @@schema("public")
}

model TenantRole {
  id        String   @id @default(cuid())
  userId    String
  tenantId  String
  role      UserRole
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([userId, tenantId])
  @@schema("public")
}

model Facility {
  id       String  @id @default(cuid())
  name     String
  npi      String?
  tenantId String
  tenant   Tenant  @relation(fields: [tenantId], references: [id])
  claims   Claim[]

  @@schema("public")
}

model Payer {
  id        String  @id @default(cuid())
  name      String
  payerCode String? @unique
  claims    Claim[]

  @@schema("public")
}

model Claim {
  id            String        @id @default(cuid())
  claimNumber   String        @unique
  tenantId      String
  tenant        Tenant        @relation(fields: [tenantId], references: [id])
  facilityId    String?
  facility      Facility?     @relation(fields: [facilityId], references: [id])
  payerId       String?
  payer         Payer?        @relation(fields: [payerId], references: [id])
  amount        Decimal       @db.Decimal(12, 2)
  status        ClaimStatus   @default(NEW)
  denialReason  String?
  serviceDate   DateTime
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  appeals       Appeal[]
  equitySignals EquitySignal[]

  @@schema("public")
}

enum ClaimStatus {
  NEW
  PENDING_SUBMISSION
  SUBMITTED
  DENIED
  APPEAL_DRAFT
  APPEALED
  PAID
  CLOSED

  @@schema("public")
}

model Appeal {
  id             String         @id @default(cuid())
  claimId        String
  claim          Claim          @relation(fields: [claimId], references: [id])
  status         AppealStatus   @default(DRAFT)
  draftText      String
  finalText      String?
  createdById    String
  createdBy      User           @relation(fields: [createdById], references: [id])
  createdAt      DateTime       @default(now())
  submittedAt    DateTime?
  resolvedAt     DateTime?
  outcome        AppealOutcome?
  outcomeNotes   String?
  aiModelVersion String?

  @@schema("public")
}

enum AppealStatus {
  DRAFT
  UNDER_REVIEW
  SUBMITTED
  RESOLVED

  @@schema("public")
}

enum AppealOutcome {
  APPROVED_FULL
  APPROVED_PARTIAL
  DENIED

  @@schema("public")
}

model EquitySignal {
  id        String   @id @default(cuid())
  claimId   String
  claim     Claim    @relation(fields: [claimId], references: [id])
  dimension String
  value     String
  riskScore Float
  createdAt DateTime @default(now())

  @@schema("public")
}
